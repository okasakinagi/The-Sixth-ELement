# API å¿«é€Ÿå‚è€ƒå¡

## ğŸ¯ æ ¸å¿ƒä¸‰æ­¥æµç¨‹

### 1ï¸âƒ£ è®¤è¯ï¼ˆå¿…é¡»ï¼‰
```bash
# æ³¨å†Œæˆ–ç™»å½•è·å– token
POST /auth/register | POST /auth/login
â†“
å¾—åˆ° access_token
â†“
# åç»­æ‰€æœ‰è¯·æ±‚éƒ½éœ€è¦åŠ ä¸Š
Authorization: Bearer <access_token>
```

### 2ï¸âƒ£ æ ¸å¿ƒæ“ä½œï¼ˆä¸‰é€‰ä¸€ï¼‰

**A. å‘å¸ƒé—®å·**
```bash
POST /surveys
{
  "title": "é—®å·æ ‡é¢˜",
  "link": "https://form.link",
  "reward_points": 50
}
â†“
æ‰£è´¹ï¼šuser.points -= 50
â†“
ç­‰å¾…ä»–äººå¡«ç­”
```

**B. å¡«ç­”é—®å·**
```bash
GET /surveys?status=active          # æµè§ˆåˆ—è¡¨
â†“
GET /surveys/{id}                   # æŸ¥çœ‹è¯¦æƒ…
â†“
POST /surveys/{id}/fills            # æäº¤ç­”å·
{
  "duration_seconds": 180           # å¿…é¡»å¡«ç­”è‡³å°‘ 10 ç§’
}
```

**C. å®¡æ ¸ç­”å·**
```bash
POST /fills/{id}/review
{
  "status": "approved"              # æˆ– "rejected"
}
â†“
è‹¥é€šè¿‡ï¼šuser.points += reward_points
```

### 3ï¸âƒ£ æŸ¥çœ‹ç»“æœ
```bash
GET /points/logs                    # æŸ¥çœ‹ç§¯åˆ†å˜åŒ–
â†“
GET /fills/me                       # æŸ¥çœ‹æˆ‘çš„å¡«ç­”
```

---

## ğŸ“Š æ¥å£é€ŸæŸ¥è¡¨

### è®¤è¯ï¼ˆ2ï¼‰
| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | /auth/register | æ³¨å†Œ |
| POST | /auth/login | ç™»å½• |

### ç”¨æˆ·ï¼ˆ2ï¼‰
| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | /users/me | è·å–ä¿¡æ¯ |
| PATCH | /users/me | æ›´æ–°ä¿¡æ¯ |

### é—®å·ï¼ˆ4ï¼‰
| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | /surveys | åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰ |
| GET | /surveys/{id} | è¯¦æƒ… |
| POST | /surveys | å‘å¸ƒ |
| POST | /surveys/{id}/close | å…³é—­ |

### ç­”å·ï¼ˆ3ï¼‰
| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | /surveys/{id}/fills | æäº¤ |
| GET | /fills/me | æˆ‘çš„å¡«ç­” |
| POST | /fills/{id}/review | å®¡æ ¸ |

### å…¶ä»–ï¼ˆ2ï¼‰
| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | /points/logs | ç§¯åˆ†æµæ°´ |
| POST | /reports | ä¸¾æŠ¥ |

---

## ğŸ’¡ å¸¸è§é”™è¯¯åŠè§£å†³

| é”™è¯¯ | åŸå›  | è§£å†³ |
|------|------|------|
| 401 | Token è¿‡æœŸ/ä¸å­˜åœ¨ | é‡æ–°ç™»å½• |
| 403 | æ— æƒæ“ä½œ | æ£€æŸ¥æ˜¯å¦ä¸ºèµ„æºæ‰€æœ‰è€… |
| 404 | èµ„æºä¸å­˜åœ¨ | æ£€æŸ¥ ID æ˜¯å¦æ­£ç¡® |
| 422 | å‚æ•°é”™è¯¯ | å‚è€ƒæ–‡æ¡£æ£€æŸ¥è¯·æ±‚ä½“ |

## ğŸ”‘ å…³é”®å‚æ•°

### åˆ†é¡µå‚æ•°ï¼ˆé€šç”¨ï¼‰
```json
{
  "page": 1,
  "page_size": 20
}
```

### é—®å·ç­›é€‰å‚æ•°
```
GET /surveys?status=active&min_points=10&max_minutes=30
```

### ç§¯åˆ†ç­›é€‰å‚æ•°
```
GET /points/logs?type=earn  // earn æˆ– spend
```

## ğŸ“ èµ„æº ID å‰ç¼€

- ç”¨æˆ·ï¼š`u_...`
- é—®å·ï¼š`s_...`
- å¡«å†™ï¼š`f_...`
- ç§¯åˆ†ï¼š`p_...`
- ä¸¾æŠ¥ï¼š`r_...`

## ğŸ† é‡è¦è§„åˆ™

### ç§¯åˆ†
- åˆå§‹ï¼š20 åˆ†
- å‘å¸ƒé—®å·ï¼šæ‰£è´¹ï¼ˆ-reward_pointsï¼‰
- å¡«ç­”é€šè¿‡ï¼šåŠ åˆ†ï¼ˆ+reward_pointsï¼‰
- å¡«ç­”æ‹’ç»ï¼šä¸åŠ åˆ†

### ä¿¡ç”¨åˆ†
- åˆå§‹ï¼š80 åˆ†
- è£èª‰èº«ä»½ï¼šcredit_score >= 85

### é˜²ä½œå¼Š
- å¡«ç­”æ—¶é—´æœ€å°‘ï¼š10 ç§’
- åŒä¸€ç”¨æˆ·å¯¹åŒä¸€é—®å·ï¼šåªèƒ½æäº¤ä¸€æ¬¡
- ä¸èƒ½å¡«è‡ªå·±çš„é—®å·

## ğŸ“ è¯·æ±‚ç¤ºä¾‹

### ç”¨ Fetch
```javascript
const response = await fetch('/api/v1/surveys', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    title: 'é—®å·',
    link: 'https://...',
    reward_points: 50
  })
});
const data = await response.json();
```

### ç”¨ curl
```bash
curl -X POST http://127.0.0.1:8000/api/v1/surveys \
  -H "Authorization: Bearer TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"title":"é—®å·","link":"https://...","reward_points":50}'
```

## ğŸ“š è¯¦ç»†æ–‡æ¡£ä½ç½®

| åŠŸèƒ½ | æ–‡æ¡£ |
|------|------|
| æ³¨å†Œ/ç™»å½•ç»†èŠ‚ | API-è®¤è¯.md |
| ç”¨æˆ·ä¿¡æ¯ | API-ç”¨æˆ·å’Œé—®å·åŸºç¡€.md |
| é—®å·å‘å¸ƒ | API-ç”¨æˆ·å’Œé—®å·åŸºç¡€.md |
| å¡«ç­”ä¸å®¡æ ¸ | API-ç­”å·æäº¤å’Œå®¡æ ¸.md |
| ç§¯åˆ†æ˜ç»† | API-ç§¯åˆ†å’Œä¸¾æŠ¥.md |
| å®Œæ•´è¯´æ˜ | API-æ€»è§ˆ.md |

---

## âœ… æ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰ï¼Œç¡®è®¤ä»¥ä¸‹äº‹é¡¹ï¼š

- [ ] åç«¯è¿è¡Œåœ¨ http://127.0.0.1:8000
- [ ] å‰ç«¯èƒ½è®¿é—® /api/v1 ç«¯ç‚¹
- [ ] å·²è¯»è¿‡ç›¸å…³çš„è¯¦ç»†æ–‡æ¡£
- [ ] æµ‹è¯•è¿‡è‡³å°‘ä¸€ä¸ªç«¯ç‚¹
- [ ] å‰ç«¯å·²æ·»åŠ  Authorization å¤´
- [ ] æµ‹è¯•è¿‡ 401 é”™è¯¯å¤„ç†

---

**æ‰“å°æ­¤å¡è´´åœ¨æ˜¾ç¤ºå™¨ä¸Šï¼**

