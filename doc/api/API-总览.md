# API æ€»è§ˆ

æœ¬æ–‡ä»¶ä¸ºåç«¯ API çš„æ€»è§ˆæ–‡æ¡£ã€‚è¯¦ç»†æ¥å£è¯´æ˜è¯·è§å„ä¸“é¢˜æ–‡æ¡£ã€‚

## API åˆ†ç±»

### å·²å®ç°æ¥å£ï¼ˆâœ… å·²åœ¨åç«¯å®ç°ï¼‰

- **è®¤è¯**ï¼šdoc/api/API-è®¤è¯.md
  - POST /auth/register - ç”¨æˆ·æ³¨å†Œ
  - POST /auth/login - ç”¨æˆ·ç™»å½•

- **ç”¨æˆ·ä¸é—®å·åŸºç¡€**ï¼šdoc/api/API-ç”¨æˆ·å’Œé—®å·åŸºç¡€.md
  - GET /users/me - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
  - PATCH /users/me - æ›´æ–°å½“å‰ç”¨æˆ·ä¿¡æ¯
  - GET /surveys - è·å–é—®å·åˆ—è¡¨
  - GET /surveys/{id} - è·å–é—®å·è¯¦æƒ…
  - POST /surveys - åˆ›å»ºå¹¶å‘å¸ƒé—®å·
  - POST /surveys/{id}/close - å…³é—­é—®å·

- **ç­”å·æäº¤ä¸å®¡æ ¸**ï¼šdoc/api/API-ç­”å·æäº¤å’Œå®¡æ ¸.md
  - POST /surveys/{id}/fills - æäº¤ç­”å·
  - GET /fills/me - è·å–æˆ‘çš„å¡«å†™è®°å½•
  - POST /fills/{id}/review - å®¡æ ¸ç­”å·

- **ç§¯åˆ†ä¸æŠ¥å‘Š**ï¼šdoc/api/API-ç§¯åˆ†å’Œä¸¾æŠ¥.md
  - GET /points/logs - è·å–ç§¯åˆ†æµæ°´
  - POST /reports - åˆ›å»ºä¸¾æŠ¥

### è§„åˆ’ä¸­çš„æ¥å£ï¼ˆğŸš§ éœ€è¦åç»­å®ç°ï¼‰

- **ä¸ªäººä¸»é¡µ/ç¼–è¾‘èµ„æ–™**ï¼šdoc/api/API-ä¸ªäººç•Œé¢.md
  - GET /users/me/profile - è·å–ç”¨æˆ·ç”»åƒï¼ˆå¾…å®ç°ï¼‰
  - PATCH /users/me/profile - æ›´æ–°ç”¨æˆ·ç”»åƒï¼ˆå¾…å®ç°ï¼‰

- **ä»»åŠ¡å¤§å…**ï¼šdoc/api/API-ä»»åŠ¡å¤§å….md
  - GET /task-hall/overview - è·å–ä»»åŠ¡å¤§å…æ¦‚è§ˆï¼ˆå¾…å®ç°ï¼‰

- **é—®å·ç®¡ç†**ï¼šdoc/api/API-é—®å·ç®¡ç†.md
  - GET /surveys/summary - è·å–é—®å·ç»Ÿè®¡ï¼ˆå¾…å®ç°ï¼‰
  - DELETE /surveys/{id} - åˆ é™¤é—®å·ï¼ˆå¾…å®ç°ï¼‰
  - POST /surveys/{id}/pause - æš‚åœé—®å·ï¼ˆå¾…å®ç°ï¼‰
  - POST /surveys/{id}/resume - æ¢å¤é—®å·ï¼ˆå¾…å®ç°ï¼‰

- **é—®å·åˆ¶ä½œ**ï¼šdoc/api/API-é—®å·åˆ¶ä½œ.md
  - POST /surveys/drafts - åˆ›å»ºè‰ç¨¿ï¼ˆå¾…å®ç°ï¼‰
  - GET /surveys/drafts/{id} - è·å–è‰ç¨¿ï¼ˆå¾…å®ç°ï¼‰
  - PATCH /surveys/drafts/{id} - ä¿å­˜è‰ç¨¿ï¼ˆå¾…å®ç°ï¼‰
  - POST /surveys/drafts/{id}/ai-generate - AIç”Ÿæˆé¢˜ç›®ï¼ˆå¾…å®ç°ï¼‰

- **é—®å·å¡«å†™**ï¼šdoc/api/API-é—®å·å¡«å†™.md
  - GET /surveys/{id}/fill - è·å–å¡«å†™ç•Œé¢é—®å·ï¼ˆå¾…å®ç°ï¼‰

- **æ•°æ®åˆ†æ**ï¼šdoc/api/API-æ•°æ®åˆ†æ.md
  - GET /surveys/{id}/analytics/summary - è·å–åˆ†ææ¦‚è§ˆï¼ˆå¾…å®ç°ï¼‰
  - GET /surveys/{id}/analytics/questions - è·å–é¢˜ç›®ç»Ÿè®¡ï¼ˆå¾…å®ç°ï¼‰

---

## çº¦å®š

### åŸºç¡€ä¿¡æ¯

- **Base URL**ï¼š`/api/v1`
- **Content-Type**ï¼š`application/json`
- **æ—¶é—´æ ¼å¼**ï¼šISO 8601 + Z æ—¶åŒºï¼ˆä¾‹å¦‚ `2026-01-21T10:30:00Z`ï¼‰

### è®¤è¯

- **æ–¹å¼**ï¼šBearer Token
- **å¤´éƒ¨**ï¼š`Authorization: Bearer <access_token>`
- **ç”Ÿæˆ**ï¼šæ³¨å†Œ/ç™»å½•æ—¶è¿”å›
- **è¿‡æœŸå¤„ç†**ï¼šæ”¶åˆ° 401 æ—¶æç¤ºé‡æ–°ç™»å½•

### é”™è¯¯å“åº”

```json
{
  "error": "é”™è¯¯ä¿¡æ¯æè¿°"
}
```

### HTTP çŠ¶æ€ç 

| çŠ¶æ€ç  | å«ä¹‰ |
|--------|------|
| 200 | æˆåŠŸ |
| 401 | æœªè®¤è¯æˆ– Token è¿‡æœŸ |
| 403 | æƒé™ä¸è¶³ï¼ˆå¦‚éæ‰€æœ‰è€…ï¼‰ |
| 404 | èµ„æºä¸å­˜åœ¨ |
| 405 | æ–¹æ³•ä¸å…è®¸ï¼ˆå¦‚é”™è¯¯çš„ HTTP æ–¹æ³•ï¼‰ |
| 422 | å‚æ•°æ ¡éªŒå¤±è´¥ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

---

## å¸¸è§ä¸šåŠ¡æµç¨‹

### ğŸ“ ç”¨æˆ·å‘å¸ƒé—®å·

```
1. POST /auth/login æˆ– /auth/register ç™»å½•/æ³¨å†Œ
   â†“ è·å¾— access_token
2. POST /surveys å‘å¸ƒé—®å·
   â”œâ”€ è¯·æ±‚ä½“åŒ…å« title, link, reward_points ç­‰
   â”œâ”€ ç³»ç»Ÿè‡ªåŠ¨æ‰£è´¹ï¼šuser.points -= reward_points
   â””â”€ ç”Ÿæˆç§¯åˆ†æµæ°´ï¼šPointsLog(reason: "å‘å¸ƒé—®å·æ¶ˆè€—")
   â†“
3. é—®å·çŠ¶æ€ä¸º activeï¼Œç­‰å¾…ç”¨æˆ·å¡«ç­”
```

### ğŸ“‹ ç”¨æˆ·å¡«ç­”é—®å·

```
1. GET /surveys æµè§ˆä»»åŠ¡å¤§å…ä¸­çš„é—®å·åˆ—è¡¨
   â†“
2. GET /surveys/{id} ç‚¹å‡»é—®å·æŸ¥çœ‹è¯¦æƒ…
   â†“
3. è·³è½¬åˆ° survey.linkï¼ˆç¬¬ä¸‰æ–¹é—®å·å¹³å°ï¼Œå¦‚ Google Formï¼‰
   â†“
4. ç”¨æˆ·å¡«ç­”é—®å·ï¼ˆè€—æ—¶ duration_secondsï¼‰
   â†“
5. ç‚¹å‡»æäº¤ â†’ POST /surveys/{id}/fills
   â”œâ”€ è¯·æ±‚ä½“ï¼š{ duration_seconds: 180 }
   â”œâ”€ ç³»ç»Ÿæ£€æŸ¥ï¼š
   â”‚  â”œâ”€ æ˜¯å¦ä¸ºè‡ªå·±çš„é—®å·ï¼Ÿ
   â”‚  â”œâ”€ æ˜¯å¦é‡å¤å¡«ç­”ï¼Ÿ
   â”‚  â””â”€ å¡«ç­”æ—¶é—´æ˜¯å¦è¿‡çŸ­ï¼Ÿ
   â””â”€ è¿”å›å¡«å†™è®°å½• IDï¼ŒçŠ¶æ€ä¸º pending
   â†“
6. GET /fills/me æŸ¥çœ‹æˆ‘çš„å¡«å†™è®°å½•
```

### âœ… å‘å¸ƒè€…å®¡æ ¸ç­”å·

```
1. ç”¨æˆ·å‘å¸ƒé—®å·åï¼Œç­‰å¾…ä»–äººçš„å¡«ç­”æäº¤
   â†“
2. POST /fills/{id}/review æ‰¹å‡†æˆ–æ‹’ç»ç­”å·
   â”œâ”€ è¯·æ±‚ä½“ï¼š{ status: "approved" æˆ– "rejected" }
   â”œâ”€ è‹¥é€šè¿‡ï¼ˆapprovedï¼‰ï¼š
   â”‚  â”œâ”€ user.points += reward_points
   â”‚  â”œâ”€ user.activity_points += reward_points
   â”‚  â””â”€ ç”Ÿæˆç§¯åˆ†æµæ°´ï¼šPointsLog(reason: "å®Œæˆé—®å·")
   â””â”€ è‹¥æ‹’ç»ï¼ˆrejectedï¼‰ï¼š
      â””â”€ ä¸å‘æ”¾ç§¯åˆ†
   â†“
3. å¡«å†™è€… GET /points/logs æŸ¥çœ‹æ–°å¢çš„ç§¯åˆ†è®°å½•
```

### ğŸ’° ç§¯åˆ†æŸ¥è¯¢ä¸ä¸¾æŠ¥

```
1. GET /points/logs æŸ¥çœ‹ç§¯åˆ†æµæ°´
   â”œâ”€ æ”¯æŒåˆ†é¡µï¼špage, page_size
   â”œâ”€ æ”¯æŒç­›é€‰ï¼štype (earn/spend)
   â””â”€ è¿”å›ç”¨æˆ·ä¿¡æ¯å’Œ has_honor çŠ¶æ€
   â†“
2. POST /reports ä¸¾æŠ¥ä¸å½“é—®å·æˆ–ç”¨æˆ·
   â”œâ”€ è¯·æ±‚ä½“ï¼š{ target_type, target_id, reason }
   â””â”€ ç”Ÿæˆä¸¾æŠ¥è®°å½•ï¼ŒçŠ¶æ€ä¸º pending
```

---

## ç”¨æˆ·èµ„æºï¼ˆAppUserï¼‰

| å­—æ®µ | è¯´æ˜ | åˆå§‹å€¼ |
|------|------|--------|
| id | ç”¨æˆ·IDï¼ˆå‰ç¼€ u_ï¼‰ | UUID |
| nickname | æ˜µç§° | æ³¨å†Œæ—¶æä¾› |
| email | é‚®ç®±ï¼ˆå”¯ä¸€ï¼‰ | æ³¨å†Œæ—¶æä¾› |
| password | å¯†ç  | æ˜æ–‡å­˜å‚¨ï¼ˆéœ€åŠ å¯†ï¼‰ |
| credit_score | ä¿¡ç”¨åˆ†ï¼ˆ0-100ï¼‰ | 80 |
| points | å¯ç”¨ç§¯åˆ† | 20 |
| activity_points | æ´»è·ƒåº¦ç§¯åˆ†ï¼ˆä¸å¯äº¤æ˜“ï¼‰ | 0 |
| school | å­¦æ ¡ | ç©º |
| tags | å…´è¶£æ ‡ç­¾ï¼ˆé€—å·åˆ†éš”ï¼‰ | ç©º |
| token | è®¤è¯ token | ç™»å½•æ—¶ç”Ÿæˆ |
| created_at | æ³¨å†Œæ—¶é—´ | å½“å‰æ—¶é—´ |

---

## é—®å·èµ„æºï¼ˆSurveyï¼‰

| å­—æ®µ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| id | é—®å·IDï¼ˆå‰ç¼€ s_ï¼‰ | UUID |
| title | æ ‡é¢˜ | å¿…å¡« |
| description | è¯´æ˜/å‰¯æ ‡é¢˜ | å¯é€‰ |
| link | ç¬¬ä¸‰æ–¹é—®å·é“¾æ¥ | å¿…å¡« |
| reward_points | å¥–åŠ±ç§¯åˆ† | 0 |
| estimated_minutes | é¢„è®¡è€—æ—¶ | å¯é€‰ |
| deadline | æˆªæ­¢æ—¥æœŸ | å¯é€‰ |
| status | çŠ¶æ€ï¼ˆactive/closedï¼‰ | active |
| owner_id | å‘å¸ƒè€…ID | å½“å‰ç”¨æˆ· |
| completed | å·²å®Œæˆä»½æ•° | 0 |
| target | ç›®æ ‡ä»½æ•° | 1 |
| created_at | åˆ›å»ºæ—¶é—´ | å½“å‰æ—¶é—´ |
| updated_at | æœ€åä¿®æ”¹æ—¶é—´ | å½“å‰æ—¶é—´ |

---

## å¡«å†™è®°å½•èµ„æºï¼ˆFillRecordï¼‰

| å­—æ®µ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| id | å¡«å†™IDï¼ˆå‰ç¼€ f_ï¼‰ | UUID |
| survey_id | é—®å·ID | å¿…å¡« |
| user_id | å¡«ç­”è€…ID | å½“å‰ç”¨æˆ· |
| duration_seconds | å¡«ç­”è€—æ—¶ | å¯é€‰ |
| status | å®¡æ ¸çŠ¶æ€ | pending |
| points_awarded | å·²å‘æ”¾ç§¯åˆ† | 0 |
| created_at | æäº¤æ—¶é—´ | å½“å‰æ—¶é—´ |

---

## ç§¯åˆ†æµæ°´èµ„æºï¼ˆPointsLogï¼‰

| å­—æ®µ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| id | æµæ°´IDï¼ˆå‰ç¼€ p_ï¼‰ | p_abc123... |
| user_id | ç”¨æˆ·ID | u_abc123... |
| delta | å˜åŒ–é‡ | +50 æˆ– -100 |
| reason | åŸå›  | å®Œæˆé—®å· / å‘å¸ƒé—®å·æ¶ˆè€— |
| created_at | å‘ç”Ÿæ—¶é—´ | 2026-01-21T10:30:00Z |

---

## ä¸¾æŠ¥èµ„æºï¼ˆReportï¼‰

| å­—æ®µ | è¯´æ˜ | æšä¸¾å€¼ |
|------|------|--------|
| id | ä¸¾æŠ¥IDï¼ˆå‰ç¼€ r_ï¼‰ | UUID |
| reporter_id | ä¸¾æŠ¥è€…ID | å½“å‰ç”¨æˆ· |
| target_type | è¢«ä¸¾æŠ¥ç±»å‹ | survey / user |
| target_id | è¢«ä¸¾æŠ¥èµ„æºID | s_... / u_... |
| reason | ä¸¾æŠ¥åŸå›  | è‡ªç”±æ–‡æœ¬ï¼ˆ<=200ï¼‰ |
| status | ä¸¾æŠ¥çŠ¶æ€ | pending / reviewed |
| created_at | ä¸¾æŠ¥æ—¶é—´ | å½“å‰æ—¶é—´ |

---

## å˜æ›´è®°å½•

- **2026-01-21**ï¼šè¡¥å…¨è®¤è¯ã€ç”¨æˆ·ã€é—®å·ã€ç­”å·ã€ç§¯åˆ†ã€ä¸¾æŠ¥ç­‰å®Œæ•´APIæ–‡æ¡£
- **2024-01-01**ï¼šåˆå§‹åŒ–ç‰ˆæœ¬ï¼ˆè‰æ¡ˆï¼‰

---

## å¸¸è§é—®é¢˜

### Q: Token çš„æœ‰æ•ˆæœŸæ˜¯å¤šä¹…ï¼Ÿ
A: å½“å‰è®¾è®¡ä¸­ï¼Œtoken çš„æœ‰æ•ˆæœŸä¸º 3600 ç§’ï¼ˆ1å°æ—¶ï¼‰ï¼Œä½†å®é™…æœªè¿›è¡Œè¿‡æœŸæ£€æŸ¥ã€‚å»ºè®®åç»­å®Œå–„æ­¤æœºåˆ¶ã€‚

### Q: å¦‚ä½•å¤„ç†ç”¨æˆ·ç™»å‡ºï¼Ÿ
A: å‰ç«¯æ¸…é™¤æœ¬åœ°ä¿å­˜çš„ token å³å¯ã€‚åç«¯æ— éœ€é¢å¤–æ“ä½œã€‚

### Q: é—®å·é“¾æ¥æ”¯æŒå“ªäº›ç¬¬ä¸‰æ–¹å¹³å°ï¼Ÿ
A: åªè¦æ˜¯å¯è®¿é—®çš„ HTTP(S) é“¾æ¥å³å¯ï¼Œå¸¸è§çš„æœ‰ï¼š
- Google Forms
- é—®å·æ˜Ÿ
- é—®å·ç½‘
- Typeform
- è‡ªå»ºè¡¨å•

### Q: å¦‚ä½•é˜²æ­¢åˆ·å•ï¼ˆç”¨æˆ·åå¤æäº¤ç­”å·ï¼‰ï¼Ÿ
A: ç³»ç»Ÿå·²æ£€æŸ¥å”¯ä¸€æ€§çº¦æŸï¼ˆä¸€ä¸ªç”¨æˆ·å¯¹ä¸€ä¸ªé—®å·åªèƒ½æäº¤ä¸€æ¬¡ï¼‰ã€‚å»ºè®®åç»­æ·»åŠ ï¼š
- æ—¶é—´é—´éš”æ£€æŸ¥
- å¼‚å¸¸å¡«ç­”æ—¶é—´æ£€æµ‹
- IP åœ°å€æ£€æŸ¥

### Q: å®¡æ ¸ç­”å·æ—¶èƒ½å¦æ‰¹é‡æ“ä½œï¼Ÿ
A: å½“å‰æ¥å£ä¸æ”¯æŒï¼Œåªèƒ½é€ä¸ªå®¡æ ¸ã€‚å»ºè®®åç»­å¢åŠ æ‰¹é‡æ¥å£ã€‚

